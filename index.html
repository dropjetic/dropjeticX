<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fax AI Advanced AI Chat Assistant</title>
  <meta name="description" content="Fax AI: Fast, powerful AI chat experience. Ask anything, get smart answers instantly. Built for creativity, coding, research, and more. Explore under the dropjetic ecosystem.">
  <meta name="keywords" content="Fax AI, Joachim Williams, Blox Fruits trading, Blox Fruits Discord, Blox Fruits trade value, Roblox Blox Fruits, fruit trading server, dropjetic, dropjetic.com, AI chat, free AI, artificial intelligence, chatgpt alternative">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="Fax AI - Joachim Williams | Blox Fruits Trading & AI Assistant">
  <meta property="og:description" content="Experience Fax AI, created by Joachim Williams. Perfect for queries, brainstorming, and joining active Blox Fruits trading discussions on our Discord server: https://discord.com/invite/bfhs. Powered under dropjetic ecosystem.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourdomain.com/">
  <meta property="og:image" content="https://iili.io/Fldrem7.png">
  <link rel="icon" href="https://iili.io/Fldrem7.png" />
  <style>
    :root {
      --bg-primary: #0f0f11;
      --bg-elevated: #17171a;
      --surface: #1f1f23;
      --surface-hover: #2a2a30;
      --border: #333336;
      --text-primary: #f0f0f4;
      --text-secondary: #a0a0b0;
      --accent: #10b981;
      --ai-text: #60a5fa;
      --sidebar-width: 260px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      overflow: hidden;
      position: relative;
    }
    body.has-no-messages::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(rgba(180,0,0,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(180,0,0,0.08) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: gridflow 32s linear infinite;
      opacity: 0.55;
      z-index: -1;
      pointer-events: none;
    }
    @keyframes gridflow { 0% { background-position: 0 0; } 100% { background-position: 40px 40px; } }
    #sidebar { width: var(--sidebar-width); background: var(--bg-elevated); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; }
    #sidebar-header { height: 56px; padding: 0 12px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .logo { width: 36px; height: 36px; background: url('https://iili.io/Fldrem7.png') center / contain no-repeat; border-radius: 8px; }
    .new-chat-btn { flex: 1; height: 40px; margin: 0 8px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: background 0.16s; }
    .new-chat-btn:hover { background: var(--surface-hover); }
    .search-container { padding: 12px 12px 4px; }
    #search-input { width: 100%; padding: 10px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; color: white; font-size: 14px; outline: none; }
    #search-input::placeholder { color: var(--text-secondary); }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 8px; }
    .chat-item { display: flex; align-items: center; gap: 12px; padding: 10px 14px; border-radius: 8px; color: var(--text-secondary); font-size: 14.5px; cursor: pointer; transition: all 0.14s; margin: 2px 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .chat-item:hover, .chat-item.active { background: var(--surface-hover); color: var(--text-primary); }
    .chat-item.active { background: rgba(16,185,129,0.15); color: var(--accent); }
    .section-label { padding: 16px 14px 6px; font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.4px; }
    #main { flex: 1; display: flex; flex-direction: column; }
    .messages { flex: 1; overflow-y: auto; padding: 32px 28px; display: flex; flex-direction: column; gap: 24px; }
    .welcome { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; gap: 36px; padding: 0 24px; }
    .welcome h1 { font-size: clamp(54px, 12vw, 90px); font-weight: 900; background: linear-gradient(90deg, #a78bfa, #7dd3fc, #6ee7b7, #fdba74); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
    .suggestions { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; max-width: 720px; }
    .suggestion-chip { background: var(--surface); border: 1px solid var(--border); border-radius: 999px; padding: 10px 18px; font-size: 14px; color: var(--text-primary); cursor: pointer; transition: all 0.14s; }
    .suggestion-chip:hover { background: var(--surface-hover); transform: translateY(-1px); }
    .message { max-width: 78%; padding: 14px 18px; border-radius: 18px; line-height: 1.58; font-size: 16px; }
    .user { align-self: flex-end; background: linear-gradient(135deg, #0066ff, #0055cc); color: white; border-bottom-right-radius: 6px; }
    .assistant { align-self: flex-start; background: var(--surface); border: 1px solid var(--border); border-bottom-left-radius: 6px; color: var(--ai-text); white-space: pre-wrap; }
    .status { align-self: flex-start; color: var(--text-secondary); font-style: italic; padding: 14px 18px; }
    .status::after { content: "..."; animation: dots 1.4s steps(5,end) infinite; }
    @keyframes dots { 0%,20% { content: "."; } 40% { content: ".."; } 60% { content: "..."; } 80%,100% { content: "...."; } }
    .input-area { padding: 20px 28px; background: var(--bg-primary); border-top: 1px solid var(--border); flex-shrink: 0; }
    .input-wrapper { max-width: 960px; margin: 0 auto; background: var(--surface); border: 1px solid var(--border); border-radius: 999px; padding: 8px 16px; display: flex; align-items: center; box-shadow: 0 6px 24px rgba(0,0,0,0.35); }
    #prompt { flex: 1; background: transparent; border: none; outline: none; color: white; font-size: 16px; padding: 12px 16px; resize: none; min-height: 24px; max-height: 160px; }
    #prompt::placeholder { color: var(--text-secondary); }
    button.send { background: var(--accent); color: white; border: none; border-radius: 999px; padding: 0 28px; height: 44px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    button.send:hover { background: #059669; }
    pre, code { font-family: 'SF Mono', Consolas, monospace; }
    pre { background: #111113; padding: 16px 20px; border-radius: 10px; overflow-x: auto; font-size: 14px; margin: 12px 0; border: 1px solid #222; }
    #auth-btn { background: var(--accent); color: white; border: none; padding: 8px 18px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
    #auth-btn:hover { background: #059669; }
    #sidebar-header.logged-in #auth-btn { background: #ef4444; }
    #sidebar-header.logged-in #auth-btn:hover { background: #dc2626; }
  </style>
</head>
<body class="has-no-messages">
  <aside id="sidebar">
    <div id="sidebar-header">
      <div class="logo"></div>
      <button class="new-chat-btn" id="new-chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New chat
      </button>
      <button id="auth-btn">Login</button>
    </div>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search chats..." />
    </div>
    <div class="sidebar-content">
      <div class="section-label">Your chats</div>
      <div id="chat-list"></div>
    </div>
  </aside>
  <main id="main">
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <div class="input-wrapper">
        <textarea id="prompt" placeholder="Ask anything..." rows="1" autofocus></textarea>
        <button class="send" id="send">Send</button>
      </div>
    </div>
  </main>
  <script>
    const API_BASE = "http://localhost:8000";
    let token = localStorage.getItem("fax_token");
    let currentChatId = null;
    const messagesDiv = document.getElementById("messages");
    const promptInput = document.getElementById("prompt");
    const sendBtn = document.getElementById("send");
    const newChatBtn = document.getElementById("new-chat");
    const chatList = document.getElementById("chat-list");
    const searchInput = document.getElementById("search-input");
    const authBtn = document.getElementById("auth-btn");
    const body = document.body;
    const suggestions = [
      "Explain quantum computing in simple terms",
      "Write a Python script to fetch weather data",
      "Help me plan a 3-day trip to Kyoto",
      "Brainstorm names for a sci-fi novel",
      "Teach me how to prompt AI better",
      "Compare the latest smartphone rumors"
    ];
    function showWelcome() {
      messagesDiv.innerHTML = `
        <div class="welcome">
          <h1>Fax AI</h1>
          <div class="suggestions">
            ${suggestions.map(s => `
              <div class="suggestion-chip" onclick="document.getElementById('prompt').value = '${s.replace(/'/g, "\\'")}'; document.getElementById('prompt').focus();">
                ${s}
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }
    async function loadChats() {
      if (!token) return;
      try {
        const res = await fetch(`${API_BASE}/chats`, { headers: { "Authorization": `Bearer ${token}` } });
        if (!res.ok) throw new Error();
        const chats = await res.json();
        chatList.innerHTML = "";
        chats.forEach(c => {
          const item = document.createElement("div");
          item.className = `chat-item${c.id === currentChatId ? " active" : ""}`;
          item.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>${c.title}</span>`;
          item.onclick = () => loadChat(c.id);
          chatList.appendChild(item);
        });
      } catch {
        logout();
      }
    }
    async function loadChat(id) {
      if (!token) return;
      currentChatId = id;
      try {
        const res = await fetch(`${API_BASE}/chats/${id}/messages`, { headers: { "Authorization": `Bearer ${token}` } });
        if (!res.ok) throw new Error();
        const msgs = await res.json();
        messagesDiv.innerHTML = "";
        if (msgs.length === 0) {
          showWelcome();
          body.classList.add("has-no-messages");
        } else {
          msgs.forEach(m => addMessage(m.role, m.content, false));
          body.classList.remove("has-no-messages");
        }
        document.querySelectorAll(".chat-item").forEach(el => el.classList.remove("active"));
        const activeItem = Array.from(chatList.children).find(el => el.onclick?.toString().includes(id));
        if (activeItem) activeItem.classList.add("active");
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      } catch {}
    }
    function addMessage(role, content, scroll = true) {
      const div = document.createElement("div");
      div.className = `message ${role}`;
      let html = content
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/```([\s\S]*?)```/g, '<pre>$1</pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br>');
      div.innerHTML = html;
      messagesDiv.appendChild(div);
      const welcome = messagesDiv.querySelector('.welcome');
      if (welcome) welcome.remove();
      if (scroll) messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    async function typeResponse(element, text) {
      element.textContent = '';
      for (let char of text) {
        element.textContent += char;
        await new Promise(r => setTimeout(r, Math.random() * 6 + 3));
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
    }
    async function sendMessage() {
      const text = promptInput.value.trim();
      if (!text) return;
      if (messagesDiv.querySelector('.welcome')) {
        messagesDiv.innerHTML = '';
        body.classList.remove('has-no-messages');
      }
      addMessage("user", text);
      promptInput.value = "";
      promptInput.style.height = "auto";
      const statusDiv = document.createElement("div");
      statusDiv.className = "status";
      statusDiv.textContent = "Thinking";
      messagesDiv.appendChild(statusDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      try {
        if (token && currentChatId) {
          await fetch(`${API_BASE}/chats/${currentChatId}/messages`, {
            method: "POST",
            headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
            body: JSON.stringify({ role: "user", content: text })
          });
        }
        const res = await fetch(`${API_BASE}/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: text })
        });
        if (!res.ok) throw new Error("Generation failed");
        const json = await res.json();
        const reply = json.response || "(no response)";
        statusDiv.remove();
        const assistantDiv = document.createElement("div");
        assistantDiv.className = "message assistant";
        messagesDiv.appendChild(assistantDiv);
        await typeResponse(assistantDiv, reply);
        if (token && currentChatId) {
          await fetch(`${API_BASE}/chats/${currentChatId}/messages`, {
            method: "POST",
            headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
            body: JSON.stringify({ role: "assistant", content: reply })
          });
        }
      } catch (err) {
        statusDiv.remove();
        addMessage("assistant", `Error: ${err.message}`);
      }
    }
    async function createNewChat() {
      if (!token) {
        currentChatId = "temp-" + Date.now();
        messagesDiv.innerHTML = "";
        showWelcome();
        return;
      }
      try {
        const res = await fetch(`${API_BASE}/chats`, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
          body: JSON.stringify({})
        });
        if (!res.ok) throw new Error();
        const data = await res.json();
        currentChatId = data.id;
        loadChats();
        loadChat(data.id);
      } catch {}
    }
    function logout() {
      localStorage.removeItem("fax_token");
      token = null;
      authBtn.textContent = "Login";
      authBtn.onclick = () => window.location.href = "login.html";
      chatList.innerHTML = "";
      currentChatId = null;
      messagesDiv.innerHTML = "";
      showWelcome();
    }
    sendBtn.onclick = sendMessage;
    promptInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    promptInput.addEventListener("input", () => {
      promptInput.style.height = "auto";
      promptInput.style.height = Math.min(promptInput.scrollHeight, 160) + "px";
      if (promptInput.value.trim().length > 0 && messagesDiv.querySelector('.welcome')) {
        messagesDiv.innerHTML = '';
        body.classList.remove("has-no-messages");
      }
    });
    newChatBtn.onclick = createNewChat;
    authBtn.onclick = () => window.location.href = "login.html";
    if (token) {
      authBtn.textContent = "Logout";
      authBtn.onclick = logout;
      loadChats();
      createNewChat();
    } else {
      createNewChat();
    }
  </script>
</body>
</html>
